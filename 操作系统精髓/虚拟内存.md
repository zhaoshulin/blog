#虚拟内存

----------
##硬件和控制结构
- 常驻集：进程执行过程中的任何时候，都在内存中的那一部分。
	- 页表和段表：属于常驻集
- 实存：进程只能在主存中执行
- 虚存：程序猿感觉到的内存超级大哦（disk）
- 使用了虚存的好处：
	- 简单分页：当进程运行时，所有的页都必须在内存中！（除非使用了覆盖技术）
	- 虚存分页：当进程运行时，不要求所有的页都在内存中，只要在需要的时候才读入页（局部性）
		- 把一页读入内存有可能需要把另一页读出到disk
- 局部性 => 虚存技术可行
- 页表项中的两个控制位：
	- 位置位P：
		- P=1：在内存中 => 在页表项里面还有该页的帧号
		- P=0：不在内存中
	- 脏位M：
		- M=1：已脏
		- M=0：干净的
- TLB：缓存页表项

![](http://i.imgur.com/vVnyQDH.jpg)

##Linux内存管理
- LRU中描述页的新旧程度通过：
	- 修改位：M
	- 使用位：U
	- 新--->旧：
		1. M=1 U=1
		2. M=1 U=0
		3. M=0 U=1
		4. M=0 U=0
- Linux使用三级页表结构：
	- 页目录：一个进程一个页目录
	- 页中间目录
	- 页表

![](http://i.imgur.com/uUYZ36F.jpg)

- 伙伴系统是最底层了，物理上都是连续的！（123，就算1和3空闲了，他俩也不合并）
	- 所以说：伙伴系统的目标是：把连续的页映射到连续的页帧中
- slab分配器在伙伴系统的上层：
	- 维护了多个链表
	- 每种块大小对应一个链表
	- 块可以分裂、合并；**可以在链表间移动**